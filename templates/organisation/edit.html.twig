{% extends 'base.html.twig' %}

{% block title %}Organisation creation page{% endblock %}

{% block nav %}
    {% include 'organisation/navbar.html.twig' %}
{% endblock %}

{% form_theme editForm 'bootstrap_5_layout.html.twig' %}
{% block body %}
    <div>
        <div class="available-height">
            <div class="h-50 d-flex flex-column justify-content-center align-items-center">
                <h1 class="text-center fw-bold pb-2 pt-5">My informations</h1>
                <h4 class="main-organisation-text text-center">Tell me more about your organisation</h4>
            </div>
            <div class="h-25 position-relative">
                <div id="scroll-down-mouse">
                    Let's get started!
                    <div>
                        <img src="{{ asset('build/images/website/mouse.png') }}" alt="mouse" width="50" height="auto">
                    </div>
                </div>
            </div>
        </div>
        <div>
            {{ form_start(editForm) }}
            <div data-aos="fade-right" class="w-75 w-lg-50 w-xxl-25 profile-form-row-container">
                {{ form_row(editForm.name) }}
            </div>
            <div data-aos="fade-left" class="w-75 w-lg-50 w-xxl-25 profile-form-row-container">
                {{ form_row(editForm.address) }}
            </div>
            <div data-aos="fade-right" class="w-75 w-lg-50 w-xxl-25 profile-form-row-container">
                {{ form_row(editForm.representative) }}
            </div>
            <div data-aos="fade-left" class="w-75 w-lg-50 w-xxl-25 profile-form-row-container">
                {{ form_row(editForm.organisationPictureName) }}
            </div>
            <div data-aos="fade-right" class="w-75 w-lg-50 w-xxl-25 profile-form-row-container">
                {{ form_row(editForm.activityPictureName) }}
            </div>
            <div data-aos="fade-left" class="w-75 w-lg-50 w-xxl-25 profile-form-row-container">
                {{ form_row(editForm.description) }}
            </div>
            <div data-aos="fade-right" class="w-75 w-lg-50 w-xxl-25 profile-form-row-container">
                {{ form_label(editForm.keywords) }}
                {{ form_errors(editForm.keywords) }}
                <ul id="organisation-keywords-list">
                    {% for keyword in editForm.keywords %}
                        <li class="my-3 position-relative">
                            {{ form_widget(keyword) }}
                            <span class="organisation-remove-keyword">x</span>
                        </li>
                    {% endfor %}
                    <li id="keyword-add-button" class="list-group-item mt-4 d-flex justify-content-center">
                        <div class="organisation-keyword-add">+</div>
                    </li>
                </ul>
            </div>
            <div data-aos="fade-left" class="w-75 w-lg-50 w-xxl-25 profile-form-row-container">
                {{ form_label(editForm.links) }}
                {{ form_errors(editForm.links) }}
                <ul id="organisation-links-list">
                    {% for link in editForm.links %}
                        <li class="my-3 position-relative">
                            {{ form_widget(link) }}
                            <span class="organisation-remove-link">
                                <i class="fa-solid fa-xmark"></i>
                            </span>
                        </li>
                    {% endfor %}
                    <li id="link-add-button" class="list-group-item mt-4 d-flex justify-content-center">
                        <div class="organisation-link-add">+</div>
                    </li>
                </ul>
            </div>
            {{ form_errors(editForm) }}
            <div class="d-flex mb-4">
                <div class="w-75"></div>
            <button class="validation-button" type="submit">Save</button>
            </div>
            {{ form_end(editForm) }}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        // Add a new keyword
        const keywordAddButton = document.getElementById("keyword-add-button");
        keywordAddButton.addEventListener("click", (event) => {
            const keywordsList = event.target.closest('ul');
            const keywordsListChildren = keywordsList.children;
            const lastKeyword = keywordsListChildren[keywordsListChildren.length - 2];
            const lastKeywordValue = lastKeyword.querySelector("input").value;
            if(noSpaceNoEmpty(lastKeywordValue)) {
                const newKeyword = lastKeyword.cloneNode(true);
                let newKeywordInput = newKeyword.querySelector("input");
                newKeywordInput.id = newInputId(lastKeyword);
                newKeywordInput.name = newInputName(lastKeyword);
                newKeywordInput.value = "";
                lastKeyword.after(newKeyword);
            }
        })

        function noSpaceNoEmpty(value)  {
            const removeSpace = value.replace(/\s/g, '');
            return removeSpace.length;
        }

        function newInputId(lastKeyword) {
            const lastInputId = lastKeyword.querySelector("input").id;
            const lastIdNumber = lastInputId.match(/\d+$/)[0];
            const idBase = lastInputId.substring(0, lastInputId.length - lastIdNumber.length);
            const newIdNumber = parseInt(lastIdNumber) + 1;

            return `${idBase}${newIdNumber}`;
        }

        function newInputName(lastKeyword) {
            const lasInputName = lastKeyword.querySelector("input").name;
            const lastInputBracket = lasInputName.match(/\[(\d+)\]$/)[0];
            const nameBase = lasInputName.substring(0, lasInputName.length - lastInputBracket.length);
            const lastNameNumber = lasInputName.match(/\[(\d+)\]$/)[1];
            const newInputNumber = parseInt(lastNameNumber) + 1;

            return `${nameBase}[${newInputNumber}]`;
        }

        //Remove a keyword & make it impossible to remove all the keywords
        let keywordsList = document.getElementById('organisation-keywords-list');
        let removeKeywordIcons = document.getElementsByClassName("organisation-remove-keyword");
        for (let i = 0; i < removeKeywordIcons.length; i++) {
            removeKeywordIcons[i].addEventListener("click", (event) => {
                if (keywordsList.children.length > 2) {
                    const keywordItem = event.target.closest("li");
                    keywordItem.remove();
                } else {
                    removeKeywordIcons[0].remove();
                }
                removeKeywordIcons = document.getElementsByClassName("organisation-remove-keyword");
            })
        }


    </script>
{% endblock %}
